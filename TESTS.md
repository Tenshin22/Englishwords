# Ручные автотесты (без библиотек)

## Как запускать

Из корня проекта:

```bash
python tests_manual.py
```

Если команда `python` недоступна, используйте:

```bash
python3 tests_manual.py
```

Если есть падения, скрипт завершится с ненулевым кодом (`exit code 1`).

## Изоляция файлов

Тесты не трогают реальные файлы в проекте:

- перед запуском создаётся (и очищается) папка `.test_tmp`
- тесты переходят в неё через `os.chdir(...)`
- файлы ошибок (`word_error.txt`, `translate_errors.txt`) создаются только внутри `.test_tmp`
- после прогона созданные файлы удаляются и рабочая директория возвращается обратно

## Что покрыто

- `read_lines(path)`
  - файл отсутствует → возвращает `[]`
  - файл существует → возвращает строки “как в файле” (включая `\n`)
  - пустой файл → возвращает `[]`
- `normalize_lines(lines)`
  - удаляет `\n`
  - меняет список **in-place** (тот же объект списка)
- `record_errors(eng_word, ru_word)`
  - при первой записи создаёт/дописывает оба файла ошибок
  - повторная запись того же `eng_word` не создаёт дубликаты
  - дубликаты корректно распознаются, даже если строки в файле с `\n`
  - разные ошибки дописываются в конец файлов (сохраняется порядок)
- `error_correction()`
  - при отсутствии файлов ошибок не вызывает `input()` и не падает
  - при одной ошибке и правильном ответе печатает “Вы ввели правильно!” и увеличивает счёт
  - при одной ошибке и неправильном ответе печатает правильный ответ
  - при разном количестве строк в файлах не падает с `IndexError` (обрабатывает по минимальной длине)
  - импорт `main.py` не запускает интерактивность (нет вызова `input()` на верхнем уровне)
- `run()` / `main_menu(...)`
  - `run()` можно завершить “Enter → 3” без ручного ввода (через моки)
  - `main_menu(...)` не падает на неизвестных командах и потом корректно выходит

## Ограничения

- `practice(...)` и `main_menu(...)` покрыты только smoke-сценариями “всё правильно → выход”, чтобы гарантировать отсутствие зависаний.

## Тесты на текущие недоработки (XFAIL)

В `tests_manual.py` есть несколько тестов, помеченных как ожидаемо падающие (в выводе будут `XFAIL`).
Они нужны, чтобы явно показать текущие “болезненные места” в логике/UX, но при этом не ломать общий прогон.

Сейчас отмечены такие недоработки:

- `error_correction()` сравнивает ответ без `strip()`/`lower()` → ввод вроде `"  CITY  "` считается неправильным
- `read_lines()` падает на файлах с не-UTF8 кодировкой (`UnicodeDecodeError`)
- `normalize_lines()` не убирает `\r` из строк вида `\r\n`
- `record_errors()` считает `City` и `city` разными (пишет дубликаты по регистру)
- `record_errors()` записывает пустые/пробельные значения вместо того, чтобы игнорировать
- `record_errors()` не синхронизирует пары, если `word_error.txt` уже содержит слово, а `translate_errors.txt` пуст
- `error_correction()` не очищает исправленные ошибки (файлы остаются прежними)
- `practice(...)` может зациклиться при наличии ошибок (нет гарантированного сценария выхода, если `mark != mark_check`)
- `practice(...)` падает с `ValueError`, если в выборе “продолжить/выход” ввести не число
